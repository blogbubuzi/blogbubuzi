(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{420:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"官网概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官网概述"}},[t._v("#")]),t._v(" 官网概述")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://learn.microsoft.com/en-us/windows/win32/winprog64/process-interoperability",target:"_blank",rel:"noopener noreferrer"}},[t._v("在64位Windows操作系统上，64位进程无法加载32位动态链接库。此外，32位进程不能加载64位DLL。但是，64位Windows支持64位和32位进程之间的远程过程调用(RPC)(在同一台计算机上和跨计算机)。在64位Windows操作系统下，进程外的32位COM服务器可以与64位客户端通信，进程外的64位COM服务器可以与32位客户端通信。因此，如果您有一个不支持COM的32位DLL，您可以将其包装在一个进程外的COM服务器中，并使用COM来封送对64位进程的调用。"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"使用visual-studio创建atl项目验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用visual-studio创建atl项目验证"}},[t._v("#")]),t._v(" 使用visual studio创建ATL项目验证")]),t._v(" "),s("h3",{attrs:{id:"创建项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[t._v("#")]),t._v(" 创建项目")]),t._v(" "),s("h4",{attrs:{id:"_1-创建一个com01的项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建一个com01的项目"}},[t._v("#")]),t._v(" 1. 创建一个Com01的项目")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225144940.png",alt:"20230225144940"}}),t._v(" "),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225145017.png",alt:"20230225145017"}})]),t._v(" "),s("h4",{attrs:{id:"_2-直接确认即可"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-直接确认即可"}},[t._v("#")]),t._v(" 2. 直接确认即可")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225145050.png",alt:"20230225145050"}})]),t._v(" "),s("h4",{attrs:{id:"_3-添加类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-添加类"}},[t._v("#")]),t._v(" 3. 添加类")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225145151.png",alt:"20230225145151"}})]),t._v(" "),s("h4",{attrs:{id:"_4-选中atl简单对象-输入comtest类名-然后确认"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-选中atl简单对象-输入comtest类名-然后确认"}},[t._v("#")]),t._v(" 4. 选中"),s("code",[t._v("ATL简单对象")]),t._v("，输入"),s("code",[t._v("ComTest")]),t._v("类名，然后确认")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225145315.png",alt:"20230225145315"}})]),t._v(" "),s("h4",{attrs:{id:"_5-输入progid-这个于后续程序调用有关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-输入progid-这个于后续程序调用有关"}},[t._v("#")]),t._v(" 5. 输入"),s("code",[t._v("ProgID")]),t._v(",这个于后续程序调用有关")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225145429.png",alt:"20230225145429"}})]),t._v(" "),s("blockquote",[s("p",[t._v("做到这里可以选择项目生成一下，检查是否存在错误")])]),t._v(" "),s("h4",{attrs:{id:"_6-打开comtest-h文件-添加新函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-打开comtest-h文件-添加新函数"}},[t._v("#")]),t._v(" 6. 打开"),s("code",[t._v("ComTest.h")]),t._v("文件，添加新函数")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225145748.png",alt:"20230225145748"}}),t._v("\n注意：这里函数必须以"),s("code",[t._v("HRESULT")]),t._v("为返回值，且需要携带"),s("code",[t._v("STDMETHODCALLTYPE")]),t._v("签名，否则编译不通过")]),t._v(" "),s("h4",{attrs:{id:"_7-在comtest-cpp中实现函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-在comtest-cpp中实现函数"}},[t._v("#")]),t._v(" 7. 在"),s("code",[t._v("ComTest.cpp")]),t._v("中实现函数")]),t._v(" "),s("div",{staticClass:"language-c++ line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("// CComTest\n\nHRESULT __stdcall CComTest::add(int a, int b, int* rev)\n{\n\t*rev = a + b;\n\treturn S_OK;\n}\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h4",{attrs:{id:"_8-编辑com01-idl中的导出函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-编辑com01-idl中的导出函数"}},[t._v("#")]),t._v(" 8. 编辑"),s("code",[t._v("Com01.idl")]),t._v("中的导出函数")]),t._v(" "),s("p",[t._v("把函数签名加上")]),t._v(" "),s("div",{staticClass:"language-C# line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("// 原来：\ninterface IComTest : IDispatch\n{\n};\n// 改为\ninterface IComTest : IDispatch\n{\n    HRESULT add(int a, int b, int* rev);\n};\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("h4",{attrs:{id:"_9-选择x86架构-右键项目-选择生成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-选择x86架构-右键项目-选择生成"}},[t._v("#")]),t._v(" 9. 选择x86架构，右键项目，选择生成")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/1677308783539.jpg",alt:"1677308783539"}}),t._v(" "),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225150701.png",alt:"20230225150701"}})]),t._v(" "),s("blockquote",[s("p",[t._v("可以看见，dll已经生产成功了")])]),t._v(" "),s("h4",{attrs:{id:"_10-生成后-项目中诞生了两个文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-生成后-项目中诞生了两个文件"}},[t._v("#")]),t._v(" 10. 生成后，项目中诞生了两个文件")]),t._v(" "),s("p",[t._v("注意保留"),s("code",[t._v("Com01_i.c")]),t._v("和"),s("code",[t._v("Com01_i.h")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225152213.png",alt:"20230225152213"}})]),t._v(" "),s("h3",{attrs:{id:"注册dll为com"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册dll为com"}},[t._v("#")]),t._v(" 注册DLL为COM")]),t._v(" "),s("h4",{attrs:{id:"_1-进入编译路径-打开命令行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-进入编译路径-打开命令行"}},[t._v("#")]),t._v(" 1. 进入编译路径，打开命令行")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225150818.png",alt:"20230225150818"}})]),t._v(" "),s("h4",{attrs:{id:"_2-在命令行里注册"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-在命令行里注册"}},[t._v("#")]),t._v(" 2. 在命令行里注册")]),t._v(" "),s("div",{staticClass:"language-powershell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("PS")]),t._v(" D:\\project\\CppL\\Com01\\Debug> regsvr32 Com01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dll\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("PS")]),t._v(" D:\\project\\CppL\\Com01\\Debug>\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("弹出如下消息，就说明安装成功")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225150922.png",alt:"20230225150922"}})]),t._v(" "),s("h4",{attrs:{id:"_3-添加至系统组件中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-添加至系统组件中"}},[t._v("#")]),t._v(" 3. 添加至系统组件中")]),t._v(" "),s("p",[t._v("依次打开"),s("code",[t._v("控制面板")]),t._v("->"),s("code",[t._v("Windows 工具")]),t._v("->"),s("code",[t._v("组件服务")])]),t._v(" "),s("h4",{attrs:{id:"_4-新增组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-新增组件"}},[t._v("#")]),t._v(" 4. 新增组件")]),t._v(" "),s("p",[t._v("依次打开"),s("code",[t._v("控制台根节点")]),t._v("->"),s("code",[t._v("组件服务")]),t._v("->"),s("code",[t._v("计算机")]),t._v("->"),s("code",[t._v("我的电脑")]),t._v("->"),s("code",[t._v("COM+ 应用程序")]),t._v("\n单机右键新增\n"),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151322.png",alt:"20230225151322"}}),t._v(" "),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151344.png",alt:"20230225151344"}}),t._v(" "),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151403.png",alt:"20230225151403"}})]),t._v(" "),s("p",[t._v("按需求设置账户，我这里选择本地服务\n"),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151435.png",alt:"20230225151435"}})]),t._v(" "),s("p",[t._v("直接下一步")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151457.png",alt:"20230225151457"}}),t._v(" "),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151510.png",alt:"20230225151510"}})]),t._v(" "),s("h4",{attrs:{id:"_5-将刚刚编译的dll放入组件中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-将刚刚编译的dll放入组件中"}},[t._v("#")]),t._v(" 5. 将刚刚编译的dll放入组件中")]),t._v(" "),s("p",[t._v("在组件上右键，选择新建")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151608.png",alt:"20230225151608"}})]),t._v(" "),s("p",[t._v("选择已注册组件")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151649.png",alt:"20230225151649"}})]),t._v(" "),s("p",[t._v("由于刚刚我们编译的是32位程序，所以勾选上32位，\n这里显示的名称就是创建类时填入的"),s("code",[t._v("ProgID")]),t._v(" "),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151751.png",alt:"20230225151751"}}),t._v(" "),s("img",{attrs:{src:"http://file.bubuzi.cc/20230225151904.png",alt:"20230225151904"}})]),t._v(" "),s("h3",{attrs:{id:"x64程序调用该32位程序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#x64程序调用该32位程序"}},[t._v("#")]),t._v(" x64程序调用该32位程序")]),t._v(" "),s("h4",{attrs:{id:"_1-创建一个简单的c-x64的项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建一个简单的c-x64的项目"}},[t._v("#")]),t._v(" 1. 创建一个简单的C++x64的项目")]),t._v(" "),s("h4",{attrs:{id:"_2-导入com01-i-h和com01-i-c至项目中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入com01-i-h和com01-i-c至项目中"}},[t._v("#")]),t._v(" 2. 导入"),s("code",[t._v("Com01_i.h")]),t._v("和"),s("code",[t._v("Com01_i.c")]),t._v("至项目中")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225152509.png",alt:"20230225152509"}})]),t._v(" "),s("h4",{attrs:{id:"_3-编写代码测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-编写代码测试"}},[t._v("#")]),t._v(" 3. 编写代码测试")]),t._v(" "),s("div",{staticClass:"language-c++ line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('#include <iostream>\n#include <string>\n#include "Com01_i.h"\n\nint main() {\n\tCoInitialize(NULL);\n\n\tCOSERVERINFO si;\n\tMULTI_QI     qi;\n\n\tZeroMemory(&si, sizeof(si));\n\tZeroMemory(&qi, sizeof(qi));\n\twchar_t wtext[20] = L"127.0.0.1";\n\tsi.pwszName = wtext;//自己机器的IP\n\tsi.pAuthInfo = NULL;\n\n\tqi.pIID = &IID_IComTest;\n\tqi.pItf = NULL;\n\tlong hr = CoCreateInstanceEx(CLSID_ComTest, NULL, CLSCTX_REMOTE_SERVER, &si, 1, &qi);\n\tif (FAILED(hr) || FAILED(qi.hr))\n\t{\n\t\treturn -1;\t//连接服务器失败\n\t}\n\tIComTest* pT = NULL;\n\tqi.pItf->QueryInterface(&pT);\n\tqi.pItf->Release();\n\tint a = 10;\n\tint b = 11;\n\tint c = 0;\n\tlong np = pT->add(a, b, &c);\n\tpT->Release();\n\n\tprintf("np: %d, c: %d\\n", np, c);\n\tCoUninitialize(); \n\tstd::system("pause");\n\treturn 0;\n}\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br")])]),s("p",[t._v("可以看见，64位成功调用~!")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://file.bubuzi.cc/20230225152838.png",alt:"20230225152838"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);